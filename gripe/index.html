<!doctype html>
<html lang="es" itemscope itemtype="http://schema.org/WebSite">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>🤧 Observatorio de la Gripe en España por Zensei</title>
  <meta name="description" content="Visualización y predicción de la gripe semana a semana para España">
  <meta name="author" content="Zensei">

  <!-- Mobile viewport optimization h5bp.com/ad -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- allows zoom -->
  <meta name="theme-color" content="#f58888" />



  <!-- Mobile IE allows us to activate ClearType technology for smoothing fonts for easy reading -->
  <meta http-equiv="cleartype" content="on">


  <link rel="shortcut icon" href="/assets/favicon.ico" />
  <link rel="apple-touch-icon" href="/assets/icon.png"/>
  <link rel="icon" href="/assets/icon.png"/>

  <link rel="stylesheet" type="text/css" href="/assets/main.css" />
  <!-- <link rel="stylesheet" href="https://grids.graaf.space/1170/12/16.css">--> <!-- Bootstrap Grid -->


  <!-- For Facebook -->
  <meta property="og:title" content="🤧 Observatorio de la Gripe en España por Zensei"/>
  <meta property="og:type" content="website"/>
  <meta property="og:image" content="https://zenseiapp.com/assets/zensei.png"/>
  <meta property="og:url" content="https://zenseiapp.com/game"/>
  <meta property="fb:app_id" content="1853764804894431" />
  <meta property="og:site_name" content="Zensei"/>
  <meta property="og:description" content="Visualización y predicción de la gripe semana a semana para España"/>

  <!-- for Twitter -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="🤧 Observatorio de la Gripe en España por Zensei<" />
  <meta name="twitter:description" content="Visualización y predicción de la gripe semana a semana para España" />
  <meta name="twitter:image" content="https://zenseiapp.com/assets/zensei.png" />

  <!-- For Google+ -->
  <meta itemprop="name" content="Zensei">
  <meta itemprop="description" content="Visualización y predicción de la gripe semana a semana para España">
  <meta itemprop="image" content="https://zenseiapp.com/assets/zensei.png">

  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->


  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-96842689-1', 'auto');
    ga('send', 'pageview');

  </script>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.5/nv.d3.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.2/d3.min.js" charset="utf-8"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.5/nv.d3.js"></script>
  <link rel="stylesheet" type="text/css" href="/assets/css/styles.css" />
 
  
</head>
<body>
    <header class="blog-header">

      <div class="wrapper">
        <a href="/"><div class="logo">zensei</div></a>
        <div class="blog-header__actions">
          <a class="main-cta main-cta--blog" href="https://m.me/zenseiapp"  onclick="ga('send', 'event', 'buttons', 'click', 'cta');" target="_blank">Instalar Zensei</a>
          <a id="landing" class="pull-right blog-header__secondary-cta" href="/">¿Qué es Zensei?</a>
        </div>

      </div>

    </header>

    <!-- app -->
    <div>
      <div class="padding-top">
        <div class="container-narrow center">
          <h2 style="font-size:40px; font-weight: bold;">Observatorio de la Gripe</h2>
          <br>
          <p>Los últimos datos oficiales son del <span id="date"></span>, estando en un nivel de riesgo <b><span id="risk1"></span></b> con <b><span id="today1"></span></b> casos por cada 100.000 habitantes, con respecto a la semana anterior ha cambiado en un <b><span id="pct"></span>%</b>.</p>
          <br>
          <div class="section group">
            <div class="col span_1_of_3">
              <p id="risk" style="font-size:50px; font-weight: bold;"></p>
              <h2 style="color:lightgrey; font-weight:lighter;">Riesgo</h2>
            </div>
            <div class="col span_1_of_3">
              <p id="today" style="font-size:50px; font-weight: bold;"></p>
              <h2 style="color:lightgrey; font-weight:lighter;">Casos esta semana</h2>
            </div>
            <div class="col span_1_of_3">
              <p id="yesterday" style="font-size:50px; font-weight: bold;"></p>
              <h2 style="color:lightgrey; font-weight:lighter;">Semana anterior</h2>
            </div>
          </div>
          <br>
           <nav class="segmented-button">
              <input type="radio" name="seg-1" value="timeserie" id="timeserie" checked>
              <label for="timeserie" class="first">Histórico</label>
              <input type="radio" name="seg-1" value="seasons" id="seasons">
              <label for="seasons" class="last">Temporadas</label>
            </nav>
            <br>
        </div>
        <div class="container center">
          <div id="chart">
              <h2 id="title"></h2>
              <svg></svg>
          </div>
               
        </div>
      </div>
    </div>

    <div class="container center padding-vertical">
      <p>Evita que tus amigos cojan la gripe 🙂</p>
        <ul class="social-btns">
          <li><a class="twitter-share-button" href="https://twitter.com/intent/tweet?text=Observatorio de la #gripe en #España por @zenseiapp" data-url="https://zenseiapp.com/gripe?utm_source=observatory&utm_medium=twitter&utm_campaign=landing_cta_bottom" data-size="large" @click="$emit('close')">Twittear</a></li>
          <li><div class="fb-share-button" data-href="https://zenseiapp.com/gripe?utm_source=observatory&utm_medium=facebook&utm_campaign=landing_cta_bottom" data-layout="button_count" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?src=sdkpreparse" @click="$emit('close')">Compartir</a></div></li>
          <li id="whatsappButton"><a class="whatsapp-share-button" href="whatsapp://send?text=Para que no te pongas malo https://zenseiapp.com/gripe/?utm_source=observatory%26utm_medium=whatsapp%26utm_campaign=landing_cta_bottom"><img src="https://zenseiapp.com/assets/img/whatsapp.svg" alt="Whatsapp" @click="$emit('close')">Whatsappear</a></li>
      </ul>
    </div>

    <div class="main-footer">
      <div class="container">
        <a class="contact-link" href="mailto:hola@zenseiapp.com">hola@zenseiapp.com</a>
        <ul class="legal-menu">
          <li><a href="politica-cookies.html">Política de cookies</a></li>
          <li><a href="politica-privacidad.html">Política de privacidad</a></li>
          <li><a href="/blog/">Blog</a></li>
        </ul>
      </div>
    </div>

    <div id="fb-root"></div>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/lodash/4.17.4/lodash.min.js"></script>
    <script type="text/javascript" src="/assets/js/app.js"></script>

    <script>

    Date.prototype.getWeek = function() {
      var onejan = new Date(this.getFullYear(),0,1);
      return Math.ceil((((this - onejan) / 86400000) + onejan.getDay()+1)/7);
    }
    
    var dataset = []
    var dataset2 = []

    d3.csv("data.csv", function(data) {
      
      format = d3.time.format("%Y-%m-%d %H:%M:%S")
      dataset = data.map(function(d, i) { 
        return { x:format.parse(d["date"]), y:Math.round(+d["rate"])}; 
      });

      var color = d3.scale.linear().domain([0,8]).range(['#F5F5F5', '#333333']);

      seasons = data.map(function(d, i) { 
        return { 
          y: Math.round(+d["rate"]),
          x: weekFlu(format.parse(d["date"]).getWeek()),
          season: getSeason(d)}
      });

      const grouped = _.groupBy(seasons,  car => car.season);

      for (var key in grouped) {
        index = Object.keys(grouped).indexOf(key)
        length = Object.keys(grouped).length
        if(index < length - 1){
          _color = color(index)
          strokeWidth = 1
          area=false
        }else{
          _color = "#f58888"
          strokeWidth = 3.5
          area=true
        }
        dataset2.push({
          values:grouped[key],
          key: key,
          color: _color,
          strokeWidth: strokeWidth,
          area:area
        });
      }

      function getSeason(d){
        date = format.parse(d["date"])
        week = date.getWeek()
        year = date.getFullYear()
        if(week >= 36){
          y1 = year  + 1
          return year + '-' + y1
        }else if(week < 36){
          y1 = year  - 1
          return y1 + '-' + year
        }
      }

      function weekFlu(week){
        if(week>=36){
          return week - 36
        }else{
          return week + 16
        }
      }

      function risk(value){
        if(value < 15){
          return 'Nulo'
        }else if(value < 30){
          return 'Bajo'
        }else if(value < 80){
          return 'Medio'
        }else if(value < 120){
          return 'Alto'
        }
      }

      function colorKpi(value){
        if(value < 15){
          return '#4CAF50'
        }else if(value < 30){
          return '#2196F3'
        }else if(value < 80){
          return '#ff9800'
        }else if(value < 120){
          return '#f44336'
        }
      }


      function month_name (dt){
        mlist = [ "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre" ];
          return mlist[dt.getMonth()];
      };

      latest = dataset.slice(-2)
      kpis = {
        diff: latest[0].y - latest[1].y,
        pct: ((latest[1].y- latest[0].y)/latest[0].y)*100,
        today: latest[1].y,
        yesterday: latest[0].y,
        date: latest[1].x.getDate() + ' de ' + month_name(latest[1].x) + ' del ' + latest[1].x.getFullYear(),
        risk: risk(latest[1].y),
        color: colorKpi(latest[1].y)
      }

      d3.select('#risk')
        .append("text")
        .text(kpis.risk)
        .style("color", kpis.color)

      d3.select('#risk1')
        .append("text")
        .text(kpis.risk)

      d3.select('#yesterday')
        .append("text")
        .text(kpis.yesterday)

      d3.select('#today1')
        .append("text")
        .text(kpis.today)

      d3.select('#today')
        .append("text")
        .text(kpis.today)

      d3.select('#pct')
        .append("text")
        .text(kpis.pct)

      d3.select('#date')
        .append("text")
        .text(kpis.date)


      data = [{
        key: 'Gripe',
        values: dataset.sort(sortByDateAscending),
        color: "#f58888",
        strokeWidth: 3.5,
        area: true
      }];

      function sortByDateAscending(a, b) {
          // Dates will be cast to numbers automagically:
          return a.x - b.x;
      }

      function datum(){
        data = data.sort(sortByDateAscending);
        return data
      }

      nv.addGraph(function() {

        
        var chart = nv.models.lineWithFocusChart();
        chart.xAxis.tickFormat(function(d) { return d3.time.format('%b %y')(new Date(d)) }).axisLabel("Semana del año");
        chart.x2Axis.tickFormat(function(d) { return d3.time.format('%b %y')(new Date(d)) });
        chart.yTickFormat(d3.format('s'));
        chart.yAxis.axisLabel("Casos por cada 100K habitantes");
        chart.duration(20);
        chart.useInteractiveGuideline(true);
        chart.showYAxis(true)
        chart.showXAxis(true)

        var y = d3.scale.linear()
          .range([200, 0]);
        
        y.domain([0, d3.max(dataset, function(d) { return d.y; })]);

        d3.select('#chart svg').append("line")
          .style("stroke", "orange")
          .attr("x1", 60)
          .attr("y1", y(10))
          .attr("x2", "97%")
          .attr("y2", y(10));

        d3.select('#chart svg')
          .append("text")
          .text("Límite epidémico")
          .attr("x", 62)
          .attr("y", y(14))
          .attr("font-family", "sans-serif")
          .attr("font-size", "8px")
          .attr("fill", "black");

        d3.select('#chart svg').append("line")
          .style("stroke", "orange")
          .style("stroke-dasharray","5,5")
          .attr("x1", 60)
          .attr("y1", y(30))
          .attr("x2", "97%")
          .attr("y2", y(30));

        d3.select('#chart svg')
          .append("text")
          .text("Bajo")
          .attr("x", 62)
          .attr("y", y(34))
          .attr("font-family", "sans-serif")
          .attr("font-size", "8px")
          .attr("fill", "black");

        d3.select('#chart svg').append("line")
          .style("stroke", "orange")
          .style("stroke-dasharray","5,5")
          .attr("x1", 60)
          .attr("y1", y(60))
          .attr("x2", "97%")
          .attr("y2", y(60));

        d3.select('#chart svg')
          .append("text")
          .text("Medio")
          .attr("x", 62)
          .attr("y", y(64))
          .attr("font-family", "sans-serif")
          .attr("font-size", "8px")
          .attr("fill", "black");

        d3.select('#chart svg').append("line")
          .style("stroke", "orange")
          .style("stroke-dasharray","5,5")
          .attr("x1", 60)
          .attr("y1", y(100))
          .attr("x2", "97%")
          .attr("y2", y(100));

        d3.select('#chart svg')
          .append("text")
          .text("Alto")
          .attr("x", 62)
          .attr("y", y(104))
          .attr("font-family", "sans-serif")
          .attr("font-size", "8px")
          .attr("fill", "black");

        d3.select('#chart svg')
            .datum(datum())
            .call(chart);

        $("#timeserie").click(function(){

          chart.xAxis.tickFormat(function(d) { return d3.time.format('%b %y')(new Date(d)) }).axisLabel("Semana del año");
          chart.x2Axis.tickFormat(function(d) { return d3.time.format('%b %y')(new Date(d)) });

          d3.select('#chart svg')
            .datum(datum())
            .call(chart);
          
        });

        $("#seasons").click(function(){
          d3.select('#chart svg')
            .datum(dataset2)
            .call(chart);
         
         
        });
 
        nv.utils.windowResize(chart.update);
        return chart;
    });
    

    });

    

    


</script>

  </body>
</html>

<!-- /nonessential stylesheets -->
<link href="https://fonts.googleapis.com/css?family=Palanquin+Dark%7CSource+Sans+Pro:400,600,700" rel="stylesheet">